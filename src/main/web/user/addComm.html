<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="../scripts/jquery-1.6.2.min.js" type="text/javascript"></script>
    <link rel="shortcut icon" href="favicon.ico"> <link href="/css/bootstrap.min.css?v=3.3.6" rel="stylesheet">
    <link href="/css/font-awesome.css?v=4.4.0" rel="stylesheet">
    <link href="/css/plugins/iCheck/custom.css" rel="stylesheet">
    <link href="/css/animate.css" rel="stylesheet">
    <link href="/css/style.css?v=4.1.0" rel="stylesheet">

    <script src="../scripts/ajaxfileupload.js"></script>
</head>
<body ng-app="myApp" ng-controller="CommodityController" >
<div class="row">
    <div class="col-sm-12">
        <div class="ibox float-e-margins">
            <div class="ibox-title">
                <h5>添加商品 <small></small></h5>
                <div class="ibox-tools">
                    <a class="collapse-link">
                        <i class="fa fa-chevron-up"></i>
                    </a>
                    <a class="dropdown-toggle" data-toggle="dropdown" href="form_basic.html#">
                        <i class="fa fa-wrench"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-user">
                        <li><a href="form_basic.html#">选项1</a>
                        </li>
                        <li><a href="form_basic.html#">选项2</a>
                        </li>
                    </ul>
                    <a class="close-link">
                        <i class="fa fa-times"></i>
                    </a>
                </div>
            </div>
            <div class="ibox-content">

                <div class="form-group">
                    <label class="col-sm-2 control-label">商品编号</label>

                    <div class="col-sm-10">
                        <input type="text" class="form-control" ng-model="c_id">
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">商品名称</label>

                    <div class="col-sm-10">
                        <input type="text" class="form-control" ng-model="c_name">
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-sm-2 control-label">商品品牌</label>

                    <div class="col-sm-10">
                        <input type="text" class="form-control" ng-model="brand">
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">正常价格</label>

                    <div class="col-sm-10">
                        <input type="text" class="form-control" ng-model="normal_price">
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-sm-2 control-label">零售价格</label>

                    <div class="col-sm-10">
                        <input type="text" class="form-control" ng-model="retail_price">
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-sm-2 control-label">商品状态
                    </label>
                    <div class="col-sm-10">
                        <div class="radio">
                            <label>
                                <input type="radio" checked="" value="1" ng-model="c_state" id="optionsRadios1" name="optionsRadios">选项1</label>
                                <label><input type="radio" value="2" id="optionsRadios2" name="optionsRadios" ng-model="c_state" >选项2</label>
                        </div>

                    </div>

                    <div class="hr-line-dashed"></div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">商品介绍</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control"> <span class="help-block m-b-none" ng-model="introduce"></span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-sm-2 control-label">商品属性</label>

                        <div class="col-sm-10">
                            <input type="text" class="form-control" ng-model="property">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-sm-2 control-label">商品标签</label>

                        <div class="col-sm-10">
                            <input type="text" class="form-control" ng-model="label">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-sm-2 control-label">商品库存</label>

                        <div class="col-sm-10">
                            <input type="text" class="form-control" ng-model="inventory">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-sm-2 control-label">商品大类</label>

                        <div class="col-sm-10">
                            <input type="text" class="form-control" ng-model="broad_heading">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-sm-2 control-label">商品子类别</label>

                        <div class="col-sm-10">
                            <input type="text" class="form-control" ng-model="subclass">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">商品创建时间</label>

                        <div class="col-sm-10">
                            <input type="text" class="form-control" ng-model="cdate">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">商品图片</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="pic" ng-model="picture">
                            <form name="form5"  method="post" enctype="multipart/form-data">
                                <p>  <input type="file" id="file_AjaxFile" name="file_AjaxFile">
                                    <input type="button" value="上传图片"      ng-click="fileUploadAjax()"/><span id="sp_AjaxFile"></span></p>
                            </form>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-4 col-sm-offset-2">
                            <button class="btn btn-primary" type="submit" ng-click="submitFrom()">保存内容</button>
                            <button class="btn btn-white" type="submit">取消</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="../js/angular/angular.min.js" type="text/javascript"></script>
<script>
    var app = angular.module('myApp', []);
    app.controller('CommodityController', function($scope,$http) {
        $scope.c_id = "";
        $scope.c_name="";
        $scope.brand="";
        $scope.picture="";
        $scope.normal_price="";
        $scope.retail_price="";
        $scope.c_state="";
        $scope.introduce="";
        $scope.property="";
        $scope.label="";
        $scope.inventory="";
        $scope.broad_heading="";
        $scope.subclass="";
        $scope.cdate="";
        $scope.fileUploadAjax= function() {
            if ($("#file_AjaxFile").val().length > 0) {


                $.ajaxFileUpload({
                    url: '/FileUpload/fileUpload_ajax', //用于文件上传的服务器端请求地址
                    type: "post",
                    secureuri: false, //一般设置为false
                    fileElementId: 'file_AjaxFile',
                    dataType: 'text', //返回值类型 一般设置为json
                    success: function (data)  //服务器成功响应处理函数
                    {          /**
                     获得后台返回的地址 并添加到angular
                     **/console.log(data)

                        var j=eval(data);


                        if (data.data!="fail"){
                            $scope.picture= j;
                            alert("成功!");
                        }


                    },error:function (res,err) {
                        console.log(res)
                        console.log(err)
                    }

                });
            }
            else {
                alert("请选择文件!");
            }
        };
        $scope.submitFrom = function() {
            var c_id=$scope.c_id;
            var c_name=$scope.c_name;
            var brand=$scope.brand;
            var picture= $scope.picture;
            var normal_price= $scope.normal_price;
            var retail_price= $scope.retail_price;
            var c_state= $scope.c_state;
            var introduce= $scope.introduce;
            var property= $scope.property;
            var label= $scope.label;
            var inventory= $scope.inventory;
            var broad_heading= $scope.broad_heading;
            var subclass= $scope.subclass;
            var cdate= $scope.cdate;
            var parme={'c_id':c_id,'c_name':c_name,'brand':brand,'picture':picture,
                'normal_price':normal_price,'retail_price':retail_price,'c_state':c_state,
                'introduce':introduce,'property':property,'label':label,'inventory':inventory,'broad_heading':broad_heading,
                'subclass':subclass,'cdate':cdate,
            };
            console.log("picture"+c_name)
            console.log("picture"+picture)
            $http({
                method:'POST',
                url:'/comm/addComm',
                data:parme,
                dataType:'json',
            }).success(function(data, status, headers, config){
                alert("添加成功！");
                window.location="datagridComm.html"
            }).error(function(data, status, headers, config){
                alert("error");
            })
        }
    });

</script>
<script type="text/javascript">

</script>
</body>
</html>