/**
 * jQuery EasyUI 1.3.6
 * 
 * Copyright (c) 2009-2014 www.jeasyui.com. All rights reserved.
 *
 * Licensed under the GPL license: http://www.gnu.org/licenses/gpl.txt
 * To use it on other terms please contact us at info@jeasyui.com
 *
 */

(function(a){function c(c){var e=a.data(c,"propertygrid"),f=a.data(c,"propertygrid").options;a(c).datagrid(a.extend({},f,{cls:"propertygrid",view:f.showGroup?f.groupView:f.view,onClickRow:function(e,g){b!=this&&(d(b),b=this);if(f.editIndex!=e&&g.editor){var h=a(this).datagrid("getColumnOption","value");h.editor=g.editor,d(b),a(this).datagrid("beginEdit",e),a(this).datagrid("getEditors",e)[0].target.focus(),f.editIndex=e}f.onClickRow.call(c,e,g)},loadFilter:function(a){return d(this),f.loadFilter.call(this,a)}})),a(document).unbind(".propertygrid").bind("mousedown.propertygrid",function(c){var e=a(c.target).closest("div.datagrid-view,div.combo-panel");if(e.length)return;d(b),b=undefined})}function d(b){var c=a(b);if(!c.length)return;var d=a.data(b,"propertygrid").options,e=d.editIndex;if(e==undefined)return;var f=c.datagrid("getEditors",e)[0];f&&(f.target.blur(),c.datagrid("validateRow",e)?c.datagrid("endEdit",e):c.datagrid("cancelEdit",e)),d.editIndex=undefined}var b;a.fn.propertygrid=function(b,d){if(typeof b=="string"){var e=a.fn.propertygrid.methods[b];return e?e(this,d):this.datagrid(b,d)}return b=b||{},this.each(function(){var d=a.data(this,"propertygrid");if(d)a.extend(d.options,b);else{var e=a.extend({},a.fn.propertygrid.defaults,a.fn.propertygrid.parseOptions(this),b);e.frozenColumns=a.extend(!0,[],e.frozenColumns),e.columns=a.extend(!0,[],e.columns),a.data(this,"propertygrid",{options:e})}c(this)})},a.fn.propertygrid.methods={options:function(b){return a.data(b[0],"propertygrid").options}},a.fn.propertygrid.parseOptions=function(b){return a.extend({},a.fn.datagrid.parseOptions(b),a.parser.parseOptions(b,[{showGroup:"boolean"}]))};var e=a.extend({},a.fn.datagrid.defaults.view,{render:function(b,c,d){var e=[],f=this.groups;for(var g=0;g<f.length;g++)e.push(this.renderGroup.call(this,b,g,f[g],d));a(c).html(e.join(""))},renderGroup:function(b,c,d,e){var f=a.data(b,"datagrid"),g=f.options,h=a(b).datagrid("getColumnFields",e),i=[];i.push('<div class="datagrid-group" group-index='+c+">"),i.push('<table cellspacing="0" cellpadding="0" border="0" style="height:100%"><tbody>'),i.push("<tr>"),(e&&(g.rownumbers||g.frozenColumns.length)||!e&&!g.rownumbers&&!g.frozenColumns.length)&&i.push('<td style="border:0;text-align:center;width:25px"><span class="datagrid-row-expander datagrid-row-collapse" style="display:inline-block;width:16px;height:16px;cursor:pointer">&nbsp;</span></td>'),i.push('<td style="border:0;">'),e||(i.push('<span class="datagrid-group-title">'),i.push(g.groupFormatter.call(b,d.value,d.rows)),i.push("</span>")),i.push("</td>"),i.push("</tr>"),i.push("</tbody></table>"),i.push("</div>"),i.push('<table class="datagrid-btable" cellspacing="0" cellpadding="0" border="0"><tbody>');var j=d.startIndex;for(var k=0;k<d.rows.length;k++){var l=g.rowStyler?g.rowStyler.call(b,j,d.rows[k]):"",m="",n="";typeof l=="string"?n=l:l&&(m=l["class"]||"",n=l.style||"");var o='class="datagrid-row '+(j%2&&g.striped?"datagrid-row-alt ":" ")+m+'"',p=n?'style="'+n+'"':"",q=f.rowIdPrefix+"-"+(e?1:2)+"-"+j;i.push('<tr id="'+q+'" datagrid-row-index="'+j+'" '+o+" "+p+">"),i.push(this.renderRow.call(this,b,h,e,j,d.rows[k])),i.push("</tr>"),j++}return i.push("</tbody></table>"),i.join("")},bindEvents:function(b){var c=a.data(b,"datagrid"),d=c.dc,e=d.body1.add(d.body2),f=(a.data(e[0],"events")||a._data(e[0],"events")).click[0].handler;e.unbind("click").bind("click",function(c){var d=a(c.target),e=d.closest("span.datagrid-row-expander");if(e.length){var g=e.closest("div.datagrid-group").attr("group-index");e.hasClass("datagrid-row-collapse")?a(b).datagrid("collapseGroup",g):a(b).datagrid("expandGroup",g)}else f(c);c.stopPropagation()})},onBeforeRender:function(b,c){function m(a){for(var b=0;b<f.length;b++){var c=f[b];if(c.value==a)return c}return null}function n(){a("#datagrid-group-style").length||a("head").append('<style id="datagrid-group-style">.datagrid-group{height:25px;overflow:hidden;font-weight:bold;border-bottom:1px solid #ccc;}</style>')}var d=a.data(b,"datagrid"),e=d.options;n();var f=[];for(var g=0;g<c.length;g++){var h=c[g],i=m(h[e.groupField]);i?i.rows.push(h):(i={value:h[e.groupField],rows:[h]},f.push(i))}var j=0,k=[];for(var g=0;g<f.length;g++){var i=f[g];i.startIndex=j,j+=i.rows.length,k=k.concat(i.rows)}d.data.rows=k,this.groups=f;var l=this;setTimeout(function(){l.bindEvents(b)},0)}});a.extend(a.fn.datagrid.methods,{expandGroup:function(b,c){return b.each(function(){var b=a.data(this,"datagrid").dc.view,d=b.find(c!=undefined?'div.datagrid-group[group-index="'+c+'"]':"div.datagrid-group"),e=d.find("span.datagrid-row-expander");e.hasClass("datagrid-row-expand")&&(e.removeClass("datagrid-row-expand").addClass("datagrid-row-collapse"),d.next("table").show()),a(this).datagrid("fixRowHeight")})},collapseGroup:function(b,c){return b.each(function(){var b=a.data(this,"datagrid").dc.view,d=b.find(c!=undefined?'div.datagrid-group[group-index="'+c+'"]':"div.datagrid-group"),e=d.find("span.datagrid-row-expander");e.hasClass("datagrid-row-collapse")&&(e.removeClass("datagrid-row-collapse").addClass("datagrid-row-expand"),d.next("table").hide()),a(this).datagrid("fixRowHeight")})}}),a.fn.propertygrid.defaults=a.extend({},a.fn.datagrid.defaults,{singleSelect:!0,remoteSort:!1,fitColumns:!0,loadMsg:"",frozenColumns:[[{field:"f",width:16,resizable:!1}]],columns:[[{field:"name",title:"Name",width:100,sortable:!0},{field:"value",title:"Value",width:100,resizable:!1}]],showGroup:!1,groupView:e,groupField:"group",groupFormatter:function(a,b){return a}})})(jQuery)