/**
 * jQuery EasyUI 1.3.6
 * 
 * Copyright (c) 2009-2014 www.jeasyui.com. All rights reserved.
 *
 * Licensed under the GPL license: http://www.gnu.org/licenses/gpl.txt
 * To use it on other terms please contact us at info@jeasyui.com
 *
 */

(function(a){function b(b,c){var d=a.data(b,"combo"),e=d.options,f=d.combo,g=d.panel;c&&(e.width=c);if(isNaN(e.width)){var h=a(b).clone();h.css("visibility","hidden"),h.appendTo("body"),e.width=h.outerWidth(),h.remove()}f.appendTo("body");var i=f.find("input.combo-text"),j=f.find(".combo-arrow"),k=e.hasDownArrow?j._outerWidth():0;f._outerWidth(e.width)._outerHeight(e.height),i._outerWidth(f.width()-k),i.css({height:f.height()+"px",lineHeight:f.height()+"px"}),j._outerHeight(f.height()),g.panel("resize",{width:e.panelWidth?e.panelWidth:f.outerWidth(),height:e.panelHeight}),f.insertAfter(b)}function c(b){a(b).addClass("combo-f").hide();var c=a('<span class="combo"><input type="text" class="combo-text" autocomplete="off"><span><span class="combo-arrow"></span></span><input type="hidden" class="combo-value"></span>').insertAfter(b),d=a('<div class="combo-panel"></div>').appendTo("body");d.panel({doSize:!1,closed:!0,cls:"combo-p",style:{position:"absolute",zIndex:10},onOpen:function(){var b=a(this).panel("panel");a.fn.menu?b.css("z-index",a.fn.menu.defaults.zIndex++):a.fn.window&&b.css("z-index",a.fn.window.defaults.zIndex++),a(this).panel("resize")},onBeforeClose:function(){f(this)},onClose:function(){var c=a.data(b,"combo");c&&c.options.onHidePanel.call(b)}});var e=a(b).attr("name");return e&&(c.find("input.combo-value").attr("name",e),a(b).removeAttr("name").attr("comboName",e)),{combo:c,panel:d}}function d(b){var c=a.data(b,"combo"),d=c.options,e=c.combo;d.hasDownArrow?e.find(".combo-arrow").show():e.find(".combo-arrow").hide(),k(b,d.disabled),l(b,d.readonly)}function e(b){var c=a.data(b,"combo"),d=c.combo.find("input.combo-text");d.validatebox("destroy"),c.panel.panel("destroy"),c.combo.remove(),a(b).remove()}function f(b){a(b).find(".combo-f").each(function(){var b=a(this).combo("panel");b.is(":visible")&&b.panel("close")})}function g(b){function k(){if(e.is(":visible"))i(b);else{var c=a(this).closest("div.combo-panel");a("div.combo-panel:visible").not(e).not(c).panel("close"),a(b).combo("showPanel")}h.focus()}var c=a.data(b,"combo"),d=c.options,e=c.panel,g=c.combo,h=g.find(".combo-text"),j=g.find(".combo-arrow");a(document).unbind(".combo").bind("mousedown.combo",function(b){var c=a(b.target).closest("span.combo,div.combo-p");if(c.length){f(c);return}a("body>div.combo-p>div.combo-panel:visible").panel("close")}),h.unbind(".combo"),j.unbind(".combo"),!d.disabled&&!d.readonly&&(h.bind("click.combo",function(b){if(!d.editable)k.call(this);else{var c=a(this).closest("div.combo-panel");a("div.combo-panel:visible").not(e).not(c).panel("close")}}).bind("keydown.combo paste.combo drop.combo",function(e){switch(e.keyCode){case 38:d.keyHandler.up.call(b,e);break;case 40:d.keyHandler.down.call(b,e);break;case 37:d.keyHandler.left.call(b,e);break;case 39:d.keyHandler.right.call(b,e);break;case 13:return e.preventDefault(),d.keyHandler.enter.call(b,e),!1;case 9:case 27:i(b);break;default:d.editable&&(c.timer&&clearTimeout(c.timer),c.timer=setTimeout(function(){var f=h.val();c.previousValue!=f&&(c.previousValue=f,a(b).combo("showPanel"),d.keyHandler.query.call(b,h.val(),e),a(b).combo("validate"))},d.delay))}}),j.bind("click.combo",function(){k.call(this)}).bind("mouseenter.combo",function(){a(this).addClass("combo-arrow-hover")}).bind("mouseleave.combo",function(){a(this).removeClass("combo-arrow-hover")}))}function h(b){function g(){var b=e.offset().left;return d.panelAlign=="right"&&(b+=e._outerWidth()-f._outerWidth()),b+f._outerWidth()>a(window)._outerWidth()+a(document).scrollLeft()&&(b=a(window)._outerWidth()+a(document).scrollLeft()-f._outerWidth()),b<0&&(b=0),b}function h(){var b=e.offset().top+e._outerHeight();return b+f._outerHeight()>a(window)._outerHeight()+a(document).scrollTop()&&(b=e.offset().top-f._outerHeight()),b<a(document).scrollTop()&&(b=e.offset().top+e._outerHeight()),b}var c=a.data(b,"combo"),d=c.options,e=c.combo,f=c.panel;f.panel("move",{left:g(),top:h()}),f.panel("options").closed&&(f.panel("open"),d.onShowPanel.call(b)),function(){f.is(":visible")&&(f.panel("move",{left:g(),top:h()}),setTimeout(arguments.callee,200))}()}function i(b){var c=a.data(b,"combo").panel;c.panel("close")}function j(b){var c=a.data(b,"combo").options,d=a(b).combo("textbox");d.validatebox(a.extend({},c,{deltaX:c.hasDownArrow?c.deltaX:c.deltaX>0?1:-1}))}function k(b,c){var d=a.data(b,"combo"),e=d.options,f=d.combo;c?(e.disabled=!0,a(b).attr("disabled",!0),f.find(".combo-value").attr("disabled",!0),f.find(".combo-text").attr("disabled",!0)):(e.disabled=!1,a(b).removeAttr("disabled"),f.find(".combo-value").removeAttr("disabled"),f.find(".combo-text").removeAttr("disabled"))}function l(b,c){var d=a.data(b,"combo"),e=d.options;e.readonly=c==undefined?!0:c;var f=e.readonly?!0:!e.editable;d.combo.find(".combo-text").attr("readonly",f).css("cursor",f?"pointer":"")}function m(b){var c=a.data(b,"combo"),d=c.options,e=c.combo;d.multiple?e.find("input.combo-value").remove():e.find("input.combo-value").val(""),e.find("input.combo-text").val("")}function n(b){var c=a.data(b,"combo").combo;return c.find("input.combo-text").val()}function o(b,c){var d=a.data(b,"combo"),e=d.combo.find("input.combo-text");e.val()!=c&&(e.val(c),a(b).combo("validate"),d.previousValue=c)}function p(b){var c=[],d=a.data(b,"combo").combo;return d.find("input.combo-value").each(function(){c.push(a(this).val())}),c}function q(b,c){var d=a.data(b,"combo").options,e=p(b),f=a.data(b,"combo").combo;f.find("input.combo-value").remove();var g=a(b).attr("comboName");for(var h=0;h<c.length;h++){var i=a('<input type="hidden" class="combo-value">').appendTo(f);g&&i.attr("name",g),i.val(c[h])}var j=[];for(var h=0;h<e.length;h++)j[h]=e[h];var k=[];for(var h=0;h<c.length;h++)for(var l=0;l<j.length;l++)if(c[h]==j[l]){k.push(c[h]),j.splice(l,1);break}if(k.length!=c.length||c.length!=e.length)d.multiple?d.onChange.call(b,c,e):d.onChange.call(b,c[0],e[0])}function r(a){var b=p(a);return b[0]}function s(a,b){q(a,[b])}function t(b){var c=a.data(b,"combo").options,d=c.onChange;c.onChange=function(){},c.multiple?(c.value?typeof c.value=="object"?q(b,c.value):s(b,c.value):q(b,[]),c.originalValue=p(b)):(s(b,c.value),c.originalValue=c.value),c.onChange=d}a.fn.combo=function(e,f){if(typeof e=="string"){var h=a.fn.combo.methods[e];return h?h(this,f):this.each(function(){var b=a(this).combo("textbox");b.validatebox(e,f)})}return e=e||{},this.each(function(){var f=a.data(this,"combo");if(f)a.extend(f.options,e);else{var h=c(this);f=a.data(this,"combo",{options:a.extend({},a.fn.combo.defaults,a.fn.combo.parseOptions(this),e),combo:h.combo,panel:h.panel,previousValue:null}),a(this).removeAttr("disabled")}d(this),b(this),g(this),j(this),t(this)})},a.fn.combo.methods={options:function(b){return a.data(b[0],"combo").options},panel:function(b){return a.data(b[0],"combo").panel},textbox:function(b){return a.data(b[0],"combo").combo.find("input.combo-text")},destroy:function(a){return a.each(function(){e(this)})},resize:function(a,c){return a.each(function(){b(this,c)})},showPanel:function(a){return a.each(function(){h(this)})},hidePanel:function(a){return a.each(function(){i(this)})},disable:function(a){return a.each(function(){k(this,!0),g(this)})},enable:function(a){return a.each(function(){k(this,!1),g(this)})},readonly:function(a,b){return a.each(function(){l(this,b),g(this)})},isValid:function(b){var c=a.data(b[0],"combo").combo.find("input.combo-text");return c.validatebox("isValid")},clear:function(a){return a.each(function(){m(this)})},reset:function(b){return b.each(function(){var b=a.data(this,"combo").options;b.multiple?a(this).combo("setValues",b.originalValue):a(this).combo("setValue",b.originalValue)})},getText:function(a){return n(a[0])},setText:function(a,b){return a.each(function(){o(this,b)})},getValues:function(a){return p(a[0])},setValues:function(a,b){return a.each(function(){q(this,b)})},getValue:function(a){return r(a[0])},setValue:function(a,b){return a.each(function(){s(this,b)})}},a.fn.combo.parseOptions=function(b){var c=a(b);return a.extend({},a.fn.validatebox.parseOptions(b),a.parser.parseOptions(b,["width","height","separator","panelAlign",{panelWidth:"number",editable:"boolean",hasDownArrow:"boolean",delay:"number",selectOnNavigation:"boolean"}]),{panelHeight:c.attr("panelHeight")=="auto"?"auto":parseInt(c.attr("panelHeight"))||undefined,multiple:c.attr("multiple")?!0:undefined,disabled:c.attr("disabled")?!0:undefined,readonly:c.attr("readonly")?!0:undefined,value:c.val()||undefined})},a.fn.combo.defaults=a.extend({},a.fn.validatebox.defaults,{width:"auto",height:22,panelWidth:null,panelHeight:200,panelAlign:"left",multiple:!1,selectOnNavigation:!0,separator:",",editable:!0,disabled:!1,readonly:!1,hasDownArrow:!0,value:"",delay:200,deltaX:19,keyHandler:{up:function(a){},down:function(a){},left:function(a){},right:function(a){},enter:function(a){},query:function(a,b){}},onShowPanel:function(){},onHidePanel:function(){},onChange:function(a,b){}})})(jQuery)